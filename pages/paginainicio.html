<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mechapp · Inicio</title>
        <meta name="description" content="Servicio automotriz profesional." />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="../Styles/paginainicio.css" />
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-o9N1j8Mk54f9QxWdChg8YF2LKKPeLZC1hTU9QChQ0jk="
            crossorigin=""
        />
    </head>
    <body>
        <header class="site-header">
            <div class="brand">
                <div class="brand-icon" aria-hidden="true"></div>
                <span class="brand-name">Mechapp</span>
            </div>
            <nav class="main-nav" aria-label="Principal">
                <a href="#inicio" class="nav-link active">Inicio</a>
                <a href="#citas" class="nav-link">Citas</a>
                <a href="#mensajes" class="nav-link">Mensajes</a>
                <a href="#ubicacion" class="nav-link">Ubicación</a>
                <a href="./perfil.html" class="nav-link">Perfil</a>
                <a href="./registro-taller.html" class="nav-link">Registrar Taller</a>
            </nav>
            <div class="header-actions">
                <a href="#agendar" class="button button-primary">Agendar Cita</a>
                <a href="./perfil.html" class="button ghost">Mi Perfil</a>
                <a href="./registro-taller.html" class="button ghost">Registrar Taller</a>
            </div>
        </header>

        <main>
            <section class="hero" id="inicio">
                <div class="hero-image" role="img" aria-label="Taller mecánico"></div>
                <div class="hero-content">
                    <span class="hero-tag">Tus Técnicos</span>
                    <h1>Confianza en Cada Reparación</h1>
                    <p>Tu Solución para el Mantenimiento Automotriz.</p>
                    <a class="button" href="./perfil.html">Ver Perfil</a>
                </div>
            </section>

            <section class="search-section" aria-labelledby="buscador">
                <div class="section-header">
                    <div>
                        <h2 id="buscador">Encuentra tu taller o servicio</h2>
                        <p>Escribe el nombre de un especialista o servicio y descubre más detalles.</p>
                    </div>
                </div>
                <div class="search-control">
                    <label class="visually-hidden" for="search-input">Buscar talleres o servicios</label>
                    <input
                        type="search"
                        id="search-input"
                        placeholder="Ej. frenos, eléctrico, mantenimiento"
                        autocomplete="off"
                    />
                </div>
                <div class="search-results" id="search-results" aria-live="polite"></div>
            </section>

            <section class="card-grid" aria-labelledby="especialistas">
                <div class="section-header">
                    <div>
                        <h2 id="especialistas">Nuestros Especialistas</h2>
                        <p>Profesionales certificados listos para ayudarte.</p>
                    </div>
                    <a class="button" href="#especialistas">Ver Todos</a>
                </div>

                <div class="grid">
                    <article class="card">
                        <div class="avatar" aria-hidden="true">JS</div>
                        <div class="card-body">
                            <h3>John Smith</h3>
                            <p class="role">Especialista en motores</p>
                            <div class="rating" aria-label="4.9 estrellas">
                                <span class="stars" aria-hidden="true">★★★★★</span>
                                <span>4.9/5 (230 Reseñas)</span>
                            </div>
                        </div>
                        <a class="button" href="#">Ver Perfil</a>
                    </article>
                    <article class="card">
                        <div class="avatar" aria-hidden="true">JS</div>
                        <div class="card-body">
                            <h3>John Smith</h3>
                            <p class="role">Especialista en transmisiones</p>
                            <div class="rating" aria-label="4.8 estrellas">
                                <span class="stars" aria-hidden="true">★★★★★</span>
                                <span>4.8/5 (189 Reseñas)</span>
                            </div>
                        </div>
                        <a class="button" href="#">Ver Perfil</a>
                    </article>
                    <article class="card">
                        <div class="avatar" aria-hidden="true">JS</div>
                        <div class="card-body">
                            <h3>John Smith</h3>
                            <p class="role">Especialista en frenos</p>
                            <div class="rating" aria-label="4.7 estrellas">
                                <span class="stars" aria-hidden="true">★★★★★</span>
                                <span>4.7/5 (156 Reseñas)</span>
                            </div>
                        </div>
                        <a class="button" href="#">Ver Perfil</a>
                    </article>
                </div>
            </section>

            <section class="services" id="citas" aria-labelledby="servicios">
                <div class="section-header">
                    <div>
                        <h2 id="servicios">Servicios Populares</h2>
                        <p>Agenda los servicios más solicitados por nuestros clientes.</p>
                    </div>
                    <a class="button" href="#citas">Explorar</a>
                </div>
                <div class="grid">
                    <article class="service-card">
                        <div class="service-icon" aria-hidden="true"></div>
                        <div>
                            <h3>Mantenimiento General</h3>
                            <p>Incluye revisión completa de fluidos y ajustes básicos.</p>
                        </div>
                        <a class="button ghost" href="#">Próximas Citas</a>
                    </article>
                    <article class="service-card">
                        <div class="service-icon" aria-hidden="true"></div>
                        <div>
                            <h3>Diagnóstico Eléctrico</h3>
                            <p>Soluciones precisas para problemas eléctricos del vehículo.</p>
                        </div>
                        <a class="button ghost" href="#">Próximas Citas</a>
                    </article>
                    <article class="service-card">
                        <div class="service-icon" aria-hidden="true"></div>
                        <div>
                            <h3>Alineación y Balanceo</h3>
                            <p>Mejora el rendimiento y la seguridad en carretera.</p>
                        </div>
                        <a class="button ghost" href="#">Próximas Citas</a>
                    </article>
                </div>
            </section>

            <section class="location-section" id="ubicacion" aria-labelledby="geolocalizacion">
                <div class="section-header">
                    <div>
                        <h2 id="geolocalizacion">Talleres cerca de ti</h2>
                        <p>Activa tu ubicación para descubrir los talleres más próximos.</p>
                    </div>
                    <button class="button ghost" type="button" id="locate-btn">Usar mi ubicación</button>
                </div>
                <p class="location-status" id="location-status" aria-live="polite">
                    Para comenzar, pulsa "Usar mi ubicación" o permite el acceso a la localización del navegador.
                </p>
                <div id="map" class="map-container" role="region" aria-label="Mapa de talleres cercanos"></div>
            </section>
        </main>

        <footer class="site-footer" id="mensajes">
            <div class="footer-column">
                <h4>Citas Directas</h4>
                <p>Atención personalizada para empresas y flotas.</p>
            </div>
            <div class="footer-column">
                <h4>Servicios Adicionales</h4>
                <ul>
                    <li>Mantenimiento Preventivo</li>
                    <li>Inspecciones Técnicas</li>
                    <li>Reemplazo de Partes</li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Contacto</h4>
                <p>+34 900 123 456</p>
                <p>soporte@autoserv.com</p>
            </div>
        </footer>
        <script
            src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-o9N1j8Mk54f9QxWdChg8YF2LKKPeLZC1hTU9QChQ0jk="
            crossorigin=""
        ></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const searchInput = document.getElementById("search-input");
                const searchResults = document.getElementById("search-results");

                const especialistas = [
                    {
                        nombre: "John Smith",
                        especialidad: "Especialista en motores",
                        enlace: "#",
                        tipo: "Taller"
                    },
                    {
                        nombre: "John Smith",
                        especialidad: "Especialista en transmisiones",
                        enlace: "#",
                        tipo: "Taller"
                    },
                    {
                        nombre: "John Smith",
                        especialidad: "Especialista en frenos",
                        enlace: "#",
                        tipo: "Taller"
                    }
                ];

                const servicios = [
                    {
                        nombre: "Mantenimiento General",
                        descripcion: "Incluye revisión completa de fluidos y ajustes básicos.",
                        enlace: "#",
                        tipo: "Servicio"
                    },
                    {
                        nombre: "Diagnóstico Eléctrico",
                        descripcion: "Soluciones precisas para problemas eléctricos del vehículo.",
                        enlace: "#",
                        tipo: "Servicio"
                    },
                    {
                        nombre: "Alineación y Balanceo",
                        descripcion: "Mejora el rendimiento y la seguridad en carretera.",
                        enlace: "#",
                        tipo: "Servicio"
                    }
                ];

                const datosBusqueda = [...especialistas, ...servicios];

                const renderResultados = (items) => {
                    if (!items.length) {
                        searchResults.innerHTML = '<p class="empty-results">No encontramos resultados que coincidan con tu búsqueda.</p>';
                        return;
                    }

                    const fragment = document.createDocumentFragment();

                    items.forEach((item) => {
                        const article = document.createElement("article");
                        article.className = "result-item";
                        article.innerHTML = `
                            <div class="result-type" aria-hidden="true">${item.tipo}</div>
                            <div class="result-content">
                                <h3>${item.nombre}</h3>
                                <p>${item.especialidad || item.descripcion}</p>
                            </div>
                            <a class="button ghost" href="${item.enlace}">Ver más</a>
                        `;
                        fragment.appendChild(article);
                    });

                    searchResults.innerHTML = "";
                    searchResults.appendChild(fragment);
                };

                renderResultados(datosBusqueda.slice(0, 3));

                searchInput.addEventListener("input", (event) => {
                    const termino = event.target.value.trim().toLowerCase();

                    if (!termino) {
                        renderResultados(datosBusqueda.slice(0, 3));
                        return;
                    }

                    const filtrados = datosBusqueda.filter((item) => {
                        const texto = `${item.nombre} ${item.especialidad || ""} ${item.descripcion || ""}`.toLowerCase();
                        return texto.includes(termino);
                    });

                    renderResultados(filtrados);
                });

                const locateBtn = document.getElementById("locate-btn");
                const locationStatus = document.getElementById("location-status");
                const mapContainer = document.getElementById("map");
                let mapa;
                let marcador;
                let areaCercana;

                const inicializarMapa = (latitud, longitud) => {
                    if (!mapa) {
                        mapa = L.map(mapContainer).setView([latitud, longitud], 13);
                        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                            maxZoom: 19,
                            attribution: "&copy; OpenStreetMap"
                        }).addTo(mapa);
                    } else {
                        mapa.setView([latitud, longitud], 13);
                    }

                    if (marcador) {
                        marcador.setLatLng([latitud, longitud]);
                    } else {
                        marcador = L.marker([latitud, longitud]).addTo(mapa);
                    }

                    marcador.bindPopup("Estás aquí").openPopup();

                    if (areaCercana) {
                        areaCercana.setLatLng([latitud, longitud]);
                    } else {
                        areaCercana = L.circle([latitud, longitud], {
                            radius: 1500,
                            color: "#38bdf8",
                            fillColor: "#38bdf8",
                            fillOpacity: 0.15
                        }).addTo(mapa);
                    }
                };

                const mostrarUbicacionPredeterminada = () => {
                    const madrid = { lat: 40.4168, lng: -3.7038 };
                    locationStatus.textContent = "No pudimos acceder a tu ubicación. Mostramos talleres destacados en Madrid.";
                    inicializarMapa(madrid.lat, madrid.lng);
                };

                const obtenerUbicacion = () => {
                    if (!navigator.geolocation) {
                        locationStatus.textContent = "Tu navegador no soporta geolocalización. Mostramos una ubicación de referencia.";
                        mostrarUbicacionPredeterminada();
                        return;
                    }

                    locationStatus.textContent = "Obteniendo tu ubicación…";

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            locationStatus.textContent = "¡Ubicación detectada! Estos son los talleres más cercanos.";
                            inicializarMapa(latitude, longitude);
                        },
                        (error) => {
                            console.error(error);
                            locationStatus.textContent = "No pudimos obtener tu ubicación automáticamente.";
                            mostrarUbicacionPredeterminada();
                        },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                    );
                };

                locateBtn.addEventListener("click", obtenerUbicacion);

                // Intentar cargar la ubicación por defecto una vez que el mapa sea visible
                setTimeout(() => {
                    if (!mapa) {
                        mostrarUbicacionPredeterminada();
                    }
                }, 1500);
            });
        </script>
    </body>
</html>
