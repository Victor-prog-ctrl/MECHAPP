<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Mechapp · Perfil de Usuario</title>
    <meta name="description" content="Consulta los datos de tu cuenta y el historial de talleres visitados." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../Styles/perfil.css" />
    <link rel="stylesheet" href="../Styles/chatbot.css" />
</head>

<body>
    <header class="site-header">
        <a class="brand" href="./paginainicio.html" aria-label="Volver al inicio">
            <div class="brand-icon" aria-hidden="true"></div>
            <span class="brand-name">Mechapp</span>
        </a>
        <div class="header-actions">
            <a href="./paginainicio.html" class="button ghost">Inicio</a>
            <button type="button" class="button" id="logout-button">Cerrar sesión</button>
        </div>
    </header>

    <main>
        <section class="profile-summary" aria-labelledby="profile-title">
            <div class="user-card">
                <div class="avatar" aria-hidden="true" data-profile-avatar></div>
                <div class="user-details">
                    <span class="label">Perfil</span>
                    <h1 id="profile-title" data-profile-name></h1>
                    <p class="role" data-profile-role></p>
                    <dl class="user-meta">
                        <div>
                            <dt>Correo</dt>
                            <dd data-profile-email></dd>
                        </div>
                        <div>
                            <dt>Miembro desde</dt>
                            <dd data-profile-member-since></dd>
                        </div>
                    </dl>
                    <div class="profile-actions" aria-label="Acciones de la cuenta">
                        <a class="button" href="./editar-nombre.html">Cambiar nombre</a>
                        <a class="button" href="./editar-correo.html">Cambiar correo</a>
                        <a class="button" href="./cambiar-contrasena.html">Cambiar contraseña</a>
                    </div>
                </div>
            </div>

            <div class="metrics" aria-label="Indicadores de la cuenta">
                <article class="metric-card">
                    <span class="metric-label">Citas completadas</span>
                    <strong class="metric-value">28</strong>
                    <span class="metric-caption">En los últimos 12 meses</span>
                </article>
                <article class="metric-card" data-profile-average-rating-card>
                    <span class="metric-label">Puntuación promedio</span>
                    <strong class="metric-value" data-profile-average-rating-value aria-live="polite">–</strong>
                    <span class="metric-caption" data-profile-average-rating-caption>
                        Registra tu taller para comenzar a recibir reseñas de tus clientes.
                    </span>
                </article>
                <article class="metric-card">
                    <span class="metric-label">Vehículos registrados</span>
                    <strong class="metric-value">2</strong>
                    <span class="metric-caption">Sedán 2020 · SUV 2022</span>
                </article>
            </div>

            <!-- ===== Suscripción (ajustada para profile.js) ===== -->
            <aside class="subscription-card" aria-label="Formulario de suscripción a novedades">
                <h2>Suscríbete y recibe novedades</h2>
                <p>Mantente al día con promociones, recordatorios y novedades personalizadas.</p>

                <form
                    class="subscription-form"
                    id="subscribe-form"
                    action="#"
                    method="post"
                    data-emailjs-service-id="service_yn5lpjl"
                    data-emailjs-template-id="template_gkufg9e"
                    data-emailjs-public-key="uZw4YfdppiljaIHqe"
                >
                    <label class="subscription-label" for="subscription-email">Correo electrónico</label>
                    <div class="subscription-input-group">
                        <input
                            type="email"
                            id="subscription-email"
                            name="subscriber_email"
                            placeholder="tucorreo@ejemplo.com"
                            required
                            autocomplete="email"
                        />
                        <button type="submit" id="subscribe-btn" class="button">Suscribirme</button>
                    </div>
                    <p class="subscription-note">Puedes darte de baja cuando quieras desde cualquier correo que recibas.</p>
                    <!-- feedback para profile.js -->
                    <small id="subscribe-msg" data-subscription-feedback aria-live="polite" hidden></small>
                </form>
            </aside>
            <!-- ===== Fin suscripción ===== -->

        </section>

        <section
            class="mechanic-requests"
            id="solicitudes"
            aria-labelledby="solicitudes-title"
            data-mechanic-section
            hidden
        >
            <div class="section-header">
                <div>
                    <h2 id="solicitudes-title">Solicitudes de visitas</h2>
                    <p>Revisa y gestiona las citas que los clientes han solicitado contigo.</p>
                </div>
            </div>
            <div class="requests-list" data-mechanic-requests></div>
            <p class="empty-state" data-mechanic-empty hidden>
                No tienes solicitudes pendientes por ahora. Cuando un cliente agende contigo aparecerá aquí.
            </p>
        </section>

        <section
            class="history"
            id="historial"
            aria-labelledby="historial-title"
            data-visible-for="cliente"
        >
            <div class="section-header">
                <div>
                    <h2 id="historial-title">Historial de talleres visitados</h2>
                    <p>Resumen de tus últimas experiencias en el taller.</p>
                </div>
                <a class="button ghost" href="#">Descargar historial</a>
            </div>
            <div class="history-list">
                <article class="history-item">
                    <div>
                        <h3>AutoMasters · Centro</h3>
                        <p class="item-meta">Revisión general · 12 de abril de 2024</p>
                    </div>
                    <span class="status success">Completado</span>
                </article>
                <article class="history-item">
                    <div>
                        <h3>Taller Ruiz</h3>
                        <p class="item-meta">Alineación y balanceo · 22 de febrero de 2024</p>
                    </div>
                    <span class="status success">Completado</span>
                </article>
                <article class="history-item">
                    <div>
                        <h3>ElectroAuto Norte</h3>
                        <p class="item-meta">Diagnóstico eléctrico · 15 de enero de 2024</p>
                    </div>
                    <span class="status pending">Seguimiento</span>
                </article>
            </div>
        </section>

    </main>

    <footer class="site-footer">
        <p>¿Necesitas ayuda? Escríbenos a <a href="mailto:soporte@autoserv.com">soporte@autoserv.com</a></p>
    </footer>

    <!-- Cargar EmailJS ANTES de profile.js -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" defer></script>

    <script src="../src/chatbot.js" defer></script>
    <!-- Tu JS de la página (usa EmailJS y lee los data-atributos del form) -->
    <script src="../src/profile.js" defer></script>
</body>
</html>
