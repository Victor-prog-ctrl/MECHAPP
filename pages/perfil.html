<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Mechapp · Perfil de Usuario</title>
    <meta name="description" content="Consulta los datos de tu cuenta y el historial de talleres visitados." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="icon" type="image/png" href="/assets/logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../Styles/perfil.css" />
    <link rel="stylesheet" href="../Styles/chatbot.css" />
</head>

<body>
    <header class="site-header">
        <a class="brand" href="./paginainicio.html" aria-label="Volver al inicio">
            <div class="brand-icon" aria-hidden="true"></div>
            <span class="brand-name">Mechapp</span>
        </a>
        <div class="header-actions">
            <a href="./paginainicio.html" class="button ghost">Inicio</a>
            <button type="button" class="button" id="logout-button">Cerrar sesión</button>
        </div>
    </header>

    <main>
        <section class="profile-summary" aria-labelledby="profile-title">
            <div class="user-card">
                <div class="avatar" aria-hidden="true" data-profile-avatar></div>
                <div class="user-details">
                    <span class="label">Perfil</span>
                    <h1 id="profile-title" data-profile-name></h1>
                    <p class="role" data-profile-role></p>
                    <dl class="user-meta">
                        <div>
                            <dt>Correo</dt>
                            <dd data-profile-email></dd>
                        </div>
                        <div>
                            <dt>Miembro desde</dt>
                            <dd data-profile-member-since></dd>
                        </div>
                    </dl>
                    <div class="profile-actions" aria-label="Acciones de la cuenta">
                        <a class="button" href="./editar-nombre.html">Cambiar nombre</a>
                        <a class="button" href="./editar-correo.html">Cambiar correo</a>
                        <a class="button" href="./cambiar-contrasena.html">Cambiar contraseña</a>
                        <button
                            type="button"
                            class="button"
                            data-workshop-manage-button
                            data-visible-for="mecanico"
                            hidden
                        >
                            Gestionar mi taller
                        </button>
                    </div>
                </div>
            </div>

            <div class="metrics" aria-label="Indicadores de la cuenta">
                <article class="metric-card" data-profile-completed-appointments-card data-visible-for="mecanico">
                    <span class="metric-label">Citas completadas</span>
                    <strong class="metric-value" data-profile-completed-appointments-value>0</strong>
                    <span class="metric-caption" data-profile-completed-appointments-caption>
                        En los últimos 12 meses
                    </span>
                </article>
                <article class="metric-card" data-profile-average-rating-card>
                    <span class="metric-label">Puntuación promedio</span>
                    <strong class="metric-value" data-profile-average-rating-value aria-live="polite">–</strong>
                    <span class="metric-caption" data-profile-average-rating-caption>
                        Registra tu taller para comenzar a recibir reseñas de tus clientes.
                    </span>
                </article>
            </div>

        </section>

        <section
            class="workshop-management"
            id="workshop-management"
            data-workshop-panel
            data-visible-for="mecanico"
            hidden
        >
            <div class="section-header">
                <div>
                    <h2 id="workshop-management-title">Mi taller</h2>
                    <p>Consulta y actualiza la información que ven tus clientes.</p>
                </div>
                <button type="button" class="button ghost" data-workshop-close hidden>Ocultar sección</button>
            </div>

            <div class="workshop-status" data-workshop-status hidden></div>

            <div class="workshop-overview" data-workshop-overview hidden>
                <img src="" alt="" data-workshop-photo hidden />
                <div class="workshop-overview__info">
                    <h3 data-workshop-name></h3>
                    <p class="workshop-summary" data-workshop-summary></p>
                    <dl class="workshop-meta">
                        <div>
                            <dt>Especialidades</dt>
                            <dd data-workshop-specialties></dd>
                        </div>
                        <div>
                            <dt>Años de experiencia</dt>
                            <dd data-workshop-experience></dd>
                        </div>
                    </dl>
                </div>
            </div>

            <p class="empty-state" data-workshop-empty hidden></p>

            <form
                class="workshop-form"
                data-workshop-form
                novalidate
                hidden
                aria-labelledby="workshop-management-title"
            >
                <div class="form-grid">
                    <label class="form-field">
                        <span>Nombre del taller</span>
                        <input type="text" name="workshop-name" autocomplete="organization" required />
                    </label>

                    <label class="form-field">
                        <span>Descripción breve</span>
                        <textarea
                            name="workshop-summary"
                            rows="2"
                            maxlength="200"
                            placeholder="Escribe una descripción corta para mostrar en listados"
                        ></textarea>
                    </label>

                    <label class="form-field form-field--wide">
                        <span>Descripción completa</span>
                        <textarea
                            name="workshop-description"
                            rows="5"
                            required
                            placeholder="Describe los servicios, equipo y la experiencia de tu taller"
                        ></textarea>
                    </label>

                    <label class="form-field">
                        <span>Servicios destacados</span>
                        <textarea
                            name="workshop-services"
                            rows="3"
                            placeholder="Escribe uno por línea o separados por comas"
                            required
                        ></textarea>
                    </label>

                    <label class="form-field">
                        <span>Especialidades</span>
                        <textarea
                            name="workshop-specialties"
                            rows="3"
                            placeholder="Escribe uno por línea o separados por comas"
                        ></textarea>
                    </label>

                    <label class="form-field">
                        <span>Certificaciones</span>
                        <textarea
                            name="workshop-certifications"
                            rows="3"
                            placeholder="Escribe una certificación por línea o separada por comas"
                        ></textarea>
                    </label>

                    <label class="form-field">
                        <span>Años de experiencia</span>
                        <input
                            type="number"
                            name="experience-years"
                            min="0"
                            inputmode="numeric"
                            placeholder="Ej. 5"
                        />
                    </label>

                    <label class="form-field">
                        <span>Dirección</span>
                        <input type="text" name="workshop-address" autocomplete="street-address" required />
                    </label>

                    <label class="form-field">
                        <span>Horario de atención</span>
                        <input type="text" name="workshop-schedule" placeholder="Ej. Lunes a viernes de 9:00 a 18:00" />
                    </label>

                    <label class="form-field">
                        <span>Teléfono</span>
                        <input type="tel" name="workshop-phone" autocomplete="tel" />
                    </label>

                    <label class="form-field">
                        <span>Correo de contacto</span>
                        <input type="email" name="workshop-email" autocomplete="email" />
                    </label>

                    <label class="form-field form-field--file">
                        <span>Fotografía del taller</span>
                        <input type="file" name="workshop-photo" accept="image/*" />
                        <small>Selecciona una nueva imagen solo si deseas reemplazar la actual.</small>
                    </label>
                </div>

                <div class="form-actions">
                    <button type="submit" class="button" data-workshop-submit>Guardar cambios</button>
                </div>

                <p class="form-feedback" data-workshop-feedback hidden aria-live="polite"></p>
            </form>

            <div class="workshop-danger" data-workshop-delete-section hidden>
                <div class="workshop-danger__content">
                    <h3>Eliminar taller</h3>
                    <p>
                        Al eliminar tu taller se borrarán todos los datos asociados y dejará de aparecer para los clientes.
                    </p>
                </div>
                <div class="workshop-danger__actions">
                    <button type="button" class="button button--danger" data-workshop-delete>
                        Eliminar mi taller
                    </button>
                    <p class="form-feedback" data-workshop-delete-feedback hidden aria-live="polite"></p>
                </div>
            </div>
        </section>

        <section
            class="mechanic-requests"
            id="solicitudes"
            aria-labelledby="solicitudes-title"
            data-mechanic-section
            hidden
        >
            <div class="section-header">
                <div>
                    <h2 id="solicitudes-title">Solicitudes de visitas</h2>
                    <p>Revisa y gestiona las citas que los clientes han solicitado contigo.</p>
                </div>
            </div>
            <div class="requests-list" data-mechanic-requests></div>
            <p class="empty-state" data-mechanic-empty hidden>
                No tienes solicitudes pendientes por ahora. Cuando un cliente agende contigo aparecerá aquí.
            </p>
        </section>

        <section
            class="role-upgrade"
            aria-labelledby="role-upgrade-title"
            data-visible-for="cliente"
            data-role-upgrade
        >
            <div class="section-header">
                <div>
                    <h2 id="role-upgrade-title">¿Abriste o tienes un taller?</h2>
                    <p>Envía tu formulario para que un administrador cambie tu cuenta a mecánico.</p>
                </div>
                <button type="button" class="button button--primary" data-role-upgrade-trigger>
                    Cambiar de rol
                </button>
            </div>

            <div class="role-upgrade__body">
                <p class="role-upgrade__status" data-role-upgrade-status>
                    Comparte tu certificado o formulario y te ayudaremos a cambiar a cuenta de mecánico.
                </p>

                <ul class="role-upgrade__steps">
                    <li>Adjunta tu certificado o formulario en PDF o imagen.</li>
                    <li>Lo enviaremos a un administrador para validar tu solicitud.</li>
                    <li>Cuando se apruebe, podrás iniciar sesión como mecánico.</li>
                </ul>

                <p class="role-upgrade__helper" data-role-upgrade-helper>
                    Tras enviar tu solicitud te llevaremos al inicio de sesión para que vuelvas a entrar cuando el
                    administrador la apruebe.
                </p>
            </div>
        </section>

        <section
            class="history"
            id="historial"
            aria-labelledby="historial-title"
            data-visible-for="cliente"
        >
            <div class="section-header">
                <div>
                    <h2 id="historial-title">Historial de talleres visitados</h2>
                    <p>Resumen de tus últimas experiencias en el taller.</p>
                </div>
            </div>
            <div class="history-list" data-client-history></div>
            <p class="empty-state" data-client-history-empty hidden>
                Aún no tienes visitas registradas. Agenda una cita para ver tu historial.
            </p>
        </section>

    </main>

    <div
        class="appointment-dialog-backdrop"
        data-appointment-dialog
        role="dialog"
        aria-modal="true"
        aria-labelledby="appointment-dialog-title"
        hidden
        tabindex="-1"
    >
        <section class="appointment-dialog" aria-live="polite">
            <header class="appointment-dialog__header">
                <div>
                    <p class="appointment-dialog__label">Detalle de tu cita</p>
                    <h2 id="appointment-dialog-title" data-appointment-title></h2>
                </div>
                <button type="button" class="dialog-close" data-appointment-close aria-label="Cerrar">×</button>
            </header>

            <dl class="appointment-dialog__meta">
                <div>
                    <dt>Estado</dt>
                    <dd><span class="status" data-appointment-status></span></dd>
                </div>
                <div>
                    <dt>Fecha y hora</dt>
                    <dd data-appointment-schedule>—</dd>
                </div>
                <div>
                    <dt>Tipo de visita</dt>
                    <dd data-appointment-type>—</dd>
                </div>
                <div>
                    <dt>Dirección</dt>
                    <dd data-appointment-address>—</dd>
                </div>
                <div>
                    <dt>Taller o mecánico</dt>
                    <dd data-appointment-partner>—</dd>
                </div>
            </dl>

            <p class="appointment-dialog__reason" data-appointment-reason hidden></p>
            <p class="appointment-dialog__reason appointment-dialog__reason--info" data-appointment-reschedule-note hidden></p>

            <p class="appointment-dialog__helper" data-appointment-helper hidden></p>

            <div class="appointment-dialog__actions">
                <button type="button" class="button ghost" data-appointment-reschedule>Reagendar cita</button>
                <button type="button" class="button danger" data-appointment-cancel>Cancelar cita</button>
                <button type="button" class="button" data-appointment-close>Volver</button>
            </div>
        </section>
    </div>

    <div
        class="cancel-dialog-backdrop"
        data-cancel-dialog
        role="dialog"
        aria-modal="true"
        aria-labelledby="cancel-dialog-title"
        hidden
        tabindex="-1"
    >
        <section class="cancel-dialog">
            <h2 id="cancel-dialog-title">Seguro que quieres cancelar tu cita?</h2>
            <p class="cancel-dialog__details" data-cancel-details></p>
            <div class="cancel-dialog__actions">
                <button type="button" class="button danger" data-cancel-confirm>Aceptar</button>
                <button type="button" class="button ghost" data-cancel-close>Rechazar</button>
            </div>
            <p class="form-message" data-cancel-feedback hidden></p>
        </section>
    </div>

    <div
        class="reschedule-dialog-backdrop"
        data-reschedule-dialog
        role="dialog"
        aria-modal="true"
        aria-labelledby="reschedule-dialog-title"
        hidden
        tabindex="-1"
    >
        <section class="reschedule-dialog">
            <header class="reschedule-dialog__header">
                <div>
                    <p class="reschedule-dialog__label">Reagendar cita</p>
                    <h2 id="reschedule-dialog-title">Proponer una nueva fecha</h2>
                </div>
                <button type="button" class="dialog-close" data-reschedule-close aria-label="Cerrar">×</button>
            </header>

            <form class="reschedule-form" data-reschedule-form novalidate>
                <label class="form-field form-field--wide">
                    <span>Motivo del reagendamiento</span>
                    <textarea
                        name="reschedule-reason"
                        rows="3"
                        maxlength="500"
                        data-reschedule-reason
                        placeholder="Ej. Surgió un imprevisto y necesito mover la visita a otro día."
                        required
                    ></textarea>
                </label>

                <div class="reschedule-grid">
                    <label class="form-field">
                        <span>Nueva fecha</span>
                        <input type="date" name="reschedule-date" data-reschedule-date required />
                        <small data-reschedule-date-helper>El calendario muestra solo días hábiles con cupos disponibles.</small>
                    </label>

                    <label class="form-field">
                        <span>Horario disponible</span>
                        <select name="reschedule-slot" data-reschedule-slot required>
                            <option value="">Selecciona una hora</option>
                        </select>
                        <small data-reschedule-slot-helper>Elige una hora libre en la agenda del mecánico.</small>
                    </label>
                </div>

                <p class="form-message" data-reschedule-feedback hidden></p>
                <p class="reschedule-hint">Deberás esperar la confirmación del mecánico para el reagendamiento de cita.</p>

                <div class="reschedule-actions">
                    <button type="button" class="button ghost" data-reschedule-close>Cancelar</button>
                    <button type="submit" class="button" data-reschedule-submit>Enviar solicitud</button>
                </div>
            </form>
        </section>
    </div>

    <div
        class="role-upgrade-dialog-backdrop"
        data-role-upgrade-dialog
        role="dialog"
        aria-modal="true"
        aria-labelledby="role-upgrade-dialog-title"
        hidden
        tabindex="-1"
    >
        <div class="role-upgrade-dialog">
            <div class="role-upgrade-dialog__header">
                <h2 id="role-upgrade-dialog-title">Solicitar cambio a mecánico</h2>
                <button type="button" class="dialog-close" data-role-upgrade-close aria-label="Cerrar formulario">
                    ×
                </button>
            </div>
            <p class="role-upgrade-dialog__intro">
                Sube tu certificado o formulario. Lo enviaremos al administrador para que valide la información y
                cambie tu rol.
            </p>

            <form class="role-upgrade-form" data-role-upgrade-form novalidate>
                <label class="form-field form-field--wide">
                    <span>Documento del taller (PDF, JPG o PNG)</span>
                    <input type="file" name="upgrade-certificate" accept=".pdf,image/*" required />
                </label>

                <label class="form-field form-field--wide">
                    <span>Notas para el administrador (opcional)</span>
                    <textarea
                        name="upgrade-notes"
                        rows="3"
                        placeholder="Comparte detalles relevantes sobre tu taller"
                    ></textarea>
                </label>

                <p class="form-message" data-role-upgrade-feedback hidden></p>

                <div class="role-upgrade-dialog__actions">
                    <button type="button" class="button ghost" data-role-upgrade-close>Cancelar</button>
                    <button type="submit" class="button button--primary" data-role-upgrade-submit>
                        Enviar solicitud
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div
        class="completion-dialog-backdrop"
        data-complete-dialog
        role="dialog"
        aria-modal="true"
        aria-labelledby="completion-dialog-title"
        hidden
        tabindex="-1"
    >
        <div class="completion-dialog">
            <h2 id="completion-dialog-title">Finalizar cita</h2>
            <p class="completion-dialog__message">
                Si le das a aceptar es porque su cita con el cliente ya se completó de manera eficiente.
            </p>
            <p class="completion-dialog__details" data-complete-details hidden></p>
            <label class="form-field form-field--wide completion-dialog__field">
                <span>Monto final del trabajo</span>
                <input type="number" min="0" step="0.01" inputmode="decimal" data-complete-price />
                <small class="completion-dialog__helper" data-complete-helper>
                    Ingresa el valor final cobrado al cliente.
                </small>
            </label>
            <p class="completion-dialog__feedback" data-complete-feedback hidden></p>
            <div class="completion-dialog__actions">
                <button type="button" class="button" data-complete-confirm>Aceptar</button>
                <button type="button" class="button ghost" data-complete-cancel>Cancelar</button>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <p>¿Necesitas ayuda? Escríbenos a <a href="mailto:soporte@autoserv.com">soporte@autoserv.com</a></p>
    </footer>

    <script src="../src/chatbot.js" defer></script>
    <script src="../src/profile.js" defer></script>
</body>
</html>
